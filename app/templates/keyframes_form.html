{% extends "base.html" %}

{% block title %}Keyframes Form{% endblock %}

{% block header %}
    <h1>Keyframes Form</h1>
{% endblock %}

{% block content %}
{% if keyframes %}
    <h2>Modifica Keyframes</h2>
    <form method="POST" action="{{ url_for('devices.update_keyframe') }}">
        {% for keyframe in keyframes %}
            <div class="slider-container">
                <label for="slider-{{ keyframe.id }}">Keyframe {{ keyframe.description}}:</label>
                <input type="range" id="slider-{{ keyframe.id }}" name="slider-{{ keyframe.id }}" min="0" max="255" value="{{ keyframe.value }}">
                <input type="hidden" id="resetSlider-{{ keyframe.id }}" name="resetSlider-{{ keyframe.id }}" value="{{ keyframe.value }}">
                <span id="showSliderValue-{{ keyframe.id }}">{{ keyframe.value }}</span>
            </div>
        {% endfor %}
        <input type="hidden" name="device_id" id="device_id" value="{{ device.id }}">
        <button type="submit">Salva</button>
        <button type="button" onclick=resetSliders()>Reset</button> 
    </form>
{% else %}
    <h2>Aggiungi nuovo Keyframe</h2>
    <form method="POST" action="">
        TODO: Aggiungi i campi per il nuovo keyframe
    </form>
{% endif %}
{% endblock %}

{% block scripts %}
    <script>
        // Funzione per aggiornare il valore del keyframe
        function updateSlidersValue(id) {
            const slider = document.getElementById(`slider-${id}`);
            const valueDisplay = document.getElementById(`showSliderValue-${id}`);
            valueDisplay.textContent = slider.value;
        }

        // Aggiungi un event listener a tutti gli slider
        {% for keyframe in keyframes %}
            document.getElementById(`slider-{{ keyframe.id }}`).addEventListener('input', function() {
                updateSlidersValue({{ keyframe.id }});
            });
        {% endfor %}

        // Funzione per resettare gli slider
        function resetSliders() {
            {% for keyframe in keyframes %}
                document.getElementById(`slider-{{ keyframe.id }}`).value = document.getElementById(`resetSlider-{{ keyframe.id }}`).value;
                updateSlidersValue({{ keyframe.id }});
            {% endfor %}
        }

    </script>
{% endblock %}